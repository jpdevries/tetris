!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){return"#"+Math.floor(16777215*Math.random()).toString(16)}var e=function(a,b,c,e){this.entity=a,this.color="undefined"==typeof b?d():b,this.rotation="undefined"==typeof c?0:c,this.blockSize="undefined"==typeof e?.02:e};e.prototype.draw=function(a){var b=(document.getElementById("canvas"),this.entity.components.physics.position),c=this.entity.getCurrentMatrix(),d=this.blockSize,e=this.color;a.save(),a.translate(b.x-.04,b.y);for(var f=0;f<=c.length-4;f+=4)!function(b){a.save();for(var c=0;c<b.length;c++)a.fillStyle=b[c]?e:"transparent",b[c]&&a.fillRect(0,0,d,d),a.translate(d,0);a.restore()}(c.slice(f,f+4)),a.translate(0,d);a.restore()},c.ShapeGraphicsComponent=e},{}],2:[function(a,b,c){var d=function(a){this.entity=a,this.position={x:0,y:0},this.velocity={x:0,y:0},this.acceleration={x:0,y:1}};d.prototype.update=function(){this.position.y=Math.max(-0.08,this.position.y-.02*this.acceleration.y)},c.PhysicsComponent=d},{}],3:[function(a,b,c){function d(){}var e=a("./shape");d.prototype=new e.Shape([[0,1,1,0,0,1,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0],[0,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0],[1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0]]),d.prototype.constructor=d,c.JShape=d},{"./shape":6}],4:[function(a,b,c){function d(){}var e=a("./shape");d.prototype=new e.Shape([[0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],[0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0]]),d.prototype.constructor=d,c.Line=d},{"./shape":6}],5:[function(a,b,c){function d(){}var e=a("./shape");d.prototype=new e.Shape([[1,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0],[0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,1,0,1,0,0,0,0,0,0,0]]),d.prototype.constructor=d,c.LShape=d},{"./shape":6}],6:[function(a,b,c){var d=a("../components/graphics/shape"),e=a("../components/physics/physics"),f=function(a,b){a="undefined"==typeof a?[[0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0]]:a,b="undefined"==typeof b?.02:b;var c=this;this.matrices=a,this.matrixIndex=0,this.getCurrentMatrix=function(){return c.matrices[c.matrixIndex]};var f=new e.PhysicsComponent(this);f.position.y=1,this.blockSize=b;var g=new d.ShapeGraphicsComponent(this);this.components={physics:f,graphics:g},this.rotate=function(a){f.position;c.matrixIndex+=a,c.matrixIndex>3&&(c.matrixIndex=0)},this.translate=function(a,c){var d=f.position;d.x+=a*b,d.y+=c*b}};c.Shape=f},{"../components/graphics/shape":1,"../components/physics/physics":2}],7:[function(a,b,c){function d(){}var e=a("./shape");d.prototype=new e.Shape,d.prototype.constructor=d,c.Square=d},{"./shape":6}],8:[function(a,b,c){function d(){}var e=a("./shape");d.prototype=new e.Shape([[1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0],[0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0]]),d.prototype.constructor=d,c.SShape=d},{"./shape":6}],9:[function(a,b,c){function d(){}var e=a("./shape");d.prototype=new e.Shape([[0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,1,0,0,1,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,1,0,0,0,0,0,0],[0,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0]]),d.prototype.constructor=d,c.Tee=d},{"./shape":6}],10:[function(a,b,c){function d(){}var e=a("./shape");d.prototype=new e.Shape([[0,1,0,0,1,1,0,0,1,0,0,0,0,0,0,0],[1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,1,1,0,0,1,0,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0]]),d.prototype.constructor=d,c.ZShape=d},{"./shape":6}],11:[function(a,b,c){var d=a("./tetris");document.addEventListener("DOMContentLoaded",function(){var a=new d.Tetris;a.run()})},{"./tetris":16}],12:[function(a,b,c){function d(a,b){for(var c=a.data,d=0;d<=c.length-4;d+=4)(c[d]||c[d+1]||c[d+2]||c[d+3])&&(c[d]=b[0],c[d+1]=b[1],c[d+2]=b[2],c[d+3]=b[3]);return a}function e(a){var b=document.createElement("canvas");return b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b.toDataURL()}function f(a){var b=new Image;return b.src=a,b}var g=function(a,b){this.entities=a,this.canvas=b,this.context=this.canvas.getContext("2d")};g.prototype.run=function(){window.requestAnimationFrame(this.tick.bind(this))},g.prototype.tick=function(){var a=this.canvas,b=this.context;b.globalCompositeOperation="multiply",b.clearRect(0,0,a.width,a.height),b.save(),b.translate(a.width/2,a.height),b.scale(a.height,-a.height);for(var c=document.getElementById("offscreen"),g=c.getContext("2d"),h=0;h<this.entities.length;h++){var i=this.entities[h];if(!(!1 in i.components)){var j=i.components.physics.position;b.fillStyle="blue",b.fillRect(-1,0,2,.02);var k={x:Math.ceil(a.width/2-(.04*a.height-j.x*a.height)),y:Math.ceil(a.height-(.08+j.y)*a.height),w:Math.ceil(.08*a.height),h:Math.ceil(.08*a.height)},l=function(){var a=b.getImageData(k.x,k.y,k.w,k.h);return a}();b.clearRect(-1,0,2,1),b.globalCompositeOperation="multiply",i.components.graphics.draw(b);var m=function(){var a=b.getImageData(k.x,k.y,k.w,k.h);return a}();l=d(l,[255,0,0,255]),m=d(m,[0,255,0,255]),g.clearRect(0,0,c.width,c.height),g.globalCompositeOperation="multiply",g.drawImage(f(e(l)),0,0),g.drawImage(f(e(m)),0,2);var n=function(){for(var a=g.getImageData(0,0,c.width,c.height),b=a.data,d=0;d<=b.length-4;d+=4){var e=255==b[d]&&!b[d+1]&&!b[d+2],f=!b[d]&&255==b[d+1]&&!b[d+2],h=0==b[d]&&0==b[d+1]&&0==b[d+2]&&0==b[d+3];if(!e&&!f&&!h)return console.log(b[d],b[d+1],b[d+2],b[d+3]),!0}return!1}();b.fillStyle="blue",b.fillRect(-1,0,2,.02)}}b.restore(),n||window.requestAnimationFrame(this.tick.bind(this))},c.GraphicsSystem=g},{}],13:[function(a,b,c){var d=function(a,b){this.tetris=a,this.entities=a.entities,this.canvas=b};d.prototype.run=function(){this.canvas.addEventListener("click",this.onClick.bind(this)),document.body.addEventListener("keydown",this.onkeydown.bind(this)),document.body.addEventListener("keyup",this.onkeyup.bind(this))},d.prototype.onClick=function(){this.tetris.shapes.currentShape.rotate(1)},d.prototype.onkeydown=function(a){switch(a.keyCode){case 38:this.onClick();break;case 39:this.tetris.shapes.currentShape.translate(1,0);break;case 40:this.tetris.shapes.currentShape.components.physics.acceleration.y=2;break;case 37:this.tetris.shapes.currentShape.translate(-1,0)}},d.prototype.onkeyup=function(a){this.tetris.shapes.currentShape.components.physics.acceleration.y=1},c.InputSystem=d},{}],14:[function(a,b,c){var d=function(a){this.entities=a,this.interval=null};d.prototype.run=function(){this.interval=window.setInterval(this.tick.bind(this),1e3/12)},d.prototype.tick=function(){for(var a=0;a<this.entities.length;a++){var b=this.entities[a];!1 in b.components||b.components.physics.update()}},c.PhysicsSystem=d},{}],15:[function(a,b,c){var d=(a("../entities/shape"),a("../entities/jshape")),e=a("../entities/line"),f=a("../entities/lshape"),g=a("../entities/square"),h=(a("../entities/sshape"),a("../entities/tee")),i=a("../entities/zshape"),j=function(a,b){this.entities=a,this.canvas=b,this.interval=null,this.currentShape=null};j.prototype.run=function(){this.tick()},j.prototype.pause=function(){null!=this.interval&&(window.clearInterval(this.interval),this.interval=null)},j.prototype.tick=function(){var a=[new d.JShape,new e.Line,new f.LShape,new g.Square,new h.Tee,new i.ZShape],b=a[Math.round(Math.random()*(a.length-1))];b.components.physics.position.y=1,this.entities.push(b),this.currentShape=b},c.ShapeSystem=j},{"../entities/jshape":3,"../entities/line":4,"../entities/lshape":5,"../entities/shape":6,"../entities/square":7,"../entities/sshape":8,"../entities/tee":9,"../entities/zshape":10}],16:[function(a,b,c){function d(){e.width=window.innerWidth,e.height=window.innerHeight}Math.randomRange=function(a,b){return a+Math.random()*(b-a)},Math.degreesToRadians=function(a){return a*Math.PI/180},Math.radiansToDegrees=function(a){return 180*a/Math.PI};var e=document.getElementById("canvas"),f=(e.getContext("2d"),document.getElementById("draw-a-shape"),a("./systems/graphics")),g=a("./systems/physics"),h=a("./systems/input"),i=a("./systems/shape_system"),j=(a("./entities/shape"),a("./entities/jshape"),a("./entities/line"),a("./entities/lshape"),a("./entities/square"),a("./entities/sshape"),a("./entities/tee"),a("./entities/zshape"),function(){this.entities=[],this.graphics=new f.GraphicsSystem(this.entities,e),this.physics=new g.PhysicsSystem(this.entities),this.input=new h.InputSystem(this,e),this.shapes=new i.ShapeSystem(this.entities,e)});j.prototype.run=function(){this.graphics.run(),this.physics.run(),this.input.run(),this.shapes.run()},c.Tetris=j,window.onresize=function(){d()},d()},{"./entities/jshape":3,"./entities/line":4,"./entities/lshape":5,"./entities/shape":6,"./entities/square":7,"./entities/sshape":8,"./entities/tee":9,"./entities/zshape":10,"./systems/graphics":12,"./systems/input":13,"./systems/physics":14,"./systems/shape_system":15}]},{},[11]);